<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Space Explorer</title>
<style>
    body {
        margin: 0;
        padding: 0;
        background-color: #000;
        overflow: hidden;
        font-family: Arial, sans-serif;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100vh;
    }
    #gameCanvas {
        border: 2px solid #2a52be;
        border-radius: 8px;
        background-color: #111;
        margin-top: 20px;
        touch-action: none;
    }
    #gameInfo {
        display: flex;
        justify-content: space-between;
        width: 400px;
        margin-top: 10px;
        padding: 0 10px;
    }
    #startScreen, #gameOverScreen {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        padding: 20px;
        border-radius: 10px;
    }
    #startScreen {
        background-color: rgba(0, 0, 0, 0.8);
        border: 2px solid #2a52be;
    }
    #gameOverScreen {
        background-color: rgba(0, 0, 0, 0.9);
        border: 2px solid #be2a2a;
        display: none;
    }
    button {
        background-color: #2a52be;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 10px;
    }
    button:hover {
        background-color: #3a6bed;
    }
    #exitButton {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: transparent;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        font-size: 18px;
        cursor: pointer;
        z-index: 1000;
    }
    #exitButton:hover {
        background-color: transparent;
    }
</style>
</head>
<body>
<h1>Space Explorer</h1>
<button id="exitButton">âœ•</button>

<div id="gameInfo">
    <div>Score: <span id="score">0</span></div>
    <div>Lives: <span id="lives">3</span></div>
</div>
<canvas id="gameCanvas" width="400" height="500"></canvas>

<div id="startScreen">
    <h2>Space Explorer</h2>
    <p>Gunakan panah/WASD untuk bergerak, Space untuk menembak! Bisa juga swipe di HP.</p>
    <button id="startButton">Start Game</button>
</div>

<div id="gameOverScreen">
    <h2>Game Over!</h2>
    <p>Skor Anda: <span id="finalScore">0</span></p>
    <button id="restartButton">Main Lagi</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreElement = document.getElementById('score');
const livesElement = document.getElementById('lives');
const startScreen = document.getElementById('startScreen');
const gameOverScreen = document.getElementById('gameOverScreen');
const finalScoreElement = document.getElementById('finalScore');
const startButton = document.getElementById('startButton');
const restartButton = document.getElementById('restartButton');
const exitButton = document.getElementById('exitButton');

exitButton.addEventListener('click', function() {
    if (confirm("Yakin mau keluar dari game?")) {
        window.location.href = 'index.html';
    }
});

let score = 0;
let lives = 3;
let gameRunning = false;
let animationFrameId;
let frameCount = 0;

let rapidFire = false;
let rapidFireEnd = 0;
let lastShotTime = 0;
let shootCooldown = 300;

const ship = { x: canvas.width/2-15, y: canvas.height-60, width:30, height:40, speed:5, color:'#2a52be' };
let asteroids = [], bullets = [], explosions = [], items = [];
const asteroidBaseSpeed = 2;
const asteroidSpawnBaseRate = 60;
let stars = Array.from({ length: 50 }, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, size: Math.random()*2, speed:0.5+Math.random() }));

const keys = { left:false, right:false, up:false, down:false };

// --- Kontrol Keyboard ---
window.addEventListener('keydown', e => {
    if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","a","A","d","D","w","W","s","S"," "].includes(e.key)) e.preventDefault();
    if(gameRunning){
        if(e.key==='ArrowLeft'||e.key.toLowerCase()==='a') keys.left=true;
        if(e.key==='ArrowRight'||e.key.toLowerCase()==='d') keys.right=true;
        if(e.key==='ArrowUp'||e.key.toLowerCase()==='w') keys.up=true;
        if(e.key==='ArrowDown'||e.key.toLowerCase()==='s') keys.down=true;
        if(e.key===' ') tryShoot();
    }
}, { passive:false });
window.addEventListener('keyup', e => {
    if(e.key==='ArrowLeft'||e.key.toLowerCase()==='a') keys.left=false;
    if(e.key==='ArrowRight'||e.key.toLowerCase()==='d') keys.right=false;
    if(e.key==='ArrowUp'||e.key.toLowerCase()==='w') keys.up=false;
    if(e.key==='ArrowDown'||e.key.toLowerCase()==='s') keys.down=false;
});

// --- Kontrol Touch ---
let touchStartX=0, touchStartY=0;
canvas.addEventListener('touchstart', e => {
    e.preventDefault();
    const touch = e.touches[0];
    touchStartX = touch.clientX;
    touchStartY = touch.clientY;
}, { passive:false });

canvas.addEventListener('touchmove', e => {
    e.preventDefault();
    const touch = e.touches[0];
    const deltaX = touch.clientX - touchStartX;
    const deltaY = touch.clientY - touchStartY;

    ship.x += deltaX;
    ship.y += deltaY;
    ship.x = Math.max(0, Math.min(canvas.width-ship.width, ship.x));
    ship.y = Math.max(0, Math.min(canvas.height-ship.height, ship.y));

    touchStartX = touch.clientX;
    touchStartY = touch.clientY;
}, { passive:false });

canvas.addEventListener('touchend', e => {
    e.preventDefault();
    tryShoot();
}, { passive:false });

// --- Game Functions ---
function startGame(){
    score=0; lives=3; asteroids=[]; bullets=[]; items=[]; explosions=[]; frameCount=0; rapidFire=false;
    ship.x=canvas.width/2-15; ship.y=canvas.height-60;
    scoreElement.textContent=score; livesElement.textContent=lives;
    startScreen.style.display='none'; gameOverScreen.style.display='none';
    gameRunning=true; gameLoop();
}
function endGame(){
    gameRunning=false; finalScoreElement.textContent=score; gameOverScreen.style.display='block';
    cancelAnimationFrame(animationFrameId);
}
function updateShip(){
    if(keys.left && ship.x>0) ship.x -= ship.speed;
    if(keys.right && ship.x<canvas.width-ship.width) ship.x += ship.speed;
    if(keys.up && ship.y>0) ship.y -= ship.speed;
    if(keys.down && ship.y<canvas.height-ship.height) ship.y += ship.speed;
}
function drawShip(){
    ctx.fillStyle = ship.color;
    ctx.fillRect(ship.x, ship.y, ship.width, ship.height);
    ctx.fillStyle='#ffffff';
    ctx.fillRect(ship.x+10, ship.y-10,10,10);
    ctx.fillRect(ship.x+5, ship.y+5,5,15);
    ctx.fillRect(ship.x+20, ship.y+5,5,15);
}
function spawnAsteroid(){
    const size = 15 + Math.random()*20;
    asteroids.push({ x:Math.random()*(canvas.width-size), y:-size, width:size, height:size, speed:asteroidBaseSpeed+Math.random()*2, color:`hsl(${Math.random()*60+20},70%,50%)` });
}
function tryShoot(){
    const now = Date.now();
    if(now - lastShotTime >= shootCooldown || rapidFire){
        bullets.push({ x:ship.x+ship.width/2-2, y:ship.y, width:4, height:10, speed:6, color:'#ffeb3b' });
        lastShotTime = now;
    }
}
function updateAsteroids(){
    let spawnRate = asteroidSpawnBaseRate - Math.floor(score/20); spawnRate=Math.max(15,spawnRate);
    if(frameCount % spawnRate === 0) spawnAsteroid();

    for(let i=asteroids.length-1;i>=0;i--){
        const asteroid = asteroids[i];
        asteroid.y += asteroid.speed;

        for(let j=bullets.length-1;j>=0;j--){
            const bullet=bullets[j];
            if(checkCollision(bullet, asteroid)){
                bullets.splice(j,1); asteroids.splice(i,1); explosions.push({x:asteroid.x, y:asteroid.y, radius:0, maxRadius:20}); score+=2; scoreElement.textContent=score;
                if(Math.random()<0.05) items.push({x:asteroid.x,y:asteroid.y,width:15,height:15,type:Math.random()<0.5?'life':'rapid',speed:2});
                break;
            }
        }

        if(checkCollision(asteroid, ship)){
            asteroids.splice(i,1); explosions.push({x:ship.x,y:ship.y,radius:0,maxRadius:20}); lives--; livesElement.textContent=lives;
            if(lives<=0) { endGame(); return; }
            continue;
        }

        if(asteroid.y>canvas.height){ asteroids.splice(i,1); score++; scoreElement.textContent=score; }
    }
}
function updateBullets(){
    for(let i=bullets.length-1;i>=0;i--){ bullets[i].y -= bullets[i].speed; if(bullets[i].y<-10) bullets.splice(i,1); }
}
function updateItems(){
    for(let i=items.length-1;i>=0;i--){
        const item=items[i]; item.y+=item.speed;
        if(checkCollision(item, ship)){
            if(item.type==='life'){ lives++; livesElement.textContent=lives; }
            else if(item.type==='rapid'){ rapidFire=true; rapidFireEnd=Date.now()+5000; }
            items.splice(i,1);
        } else if(item.y>canvas.height) items.splice(i,1);
    }
    if(rapidFire && Date.now()>rapidFireEnd) rapidFire=false;
}
function updateExplosions(){
    for(let i=explosions.length-1;i>=0;i--){ explosions[i].radius+=2; if(explosions[i].radius>explosions[i].maxRadius) explosions.splice(i,1); }
}
function drawAsteroids(){ asteroids.forEach(a=>{ ctx.fillStyle=a.color; ctx.fillRect(a.x,a.y,a.width,a.height); }); }
function drawBullets(){ bullets.forEach(b=>{ ctx.fillStyle=b.color; ctx.fillRect(b.x,b.y,b.width,b.height); }); }
function drawItems(){ items.forEach(it=>{ ctx.fillStyle=it.type==='life'?'#4caf50':'#ff9800'; ctx.fillRect(it.x,it.y,it.width,it.height); }); }
function drawExplosions(){ explosions.forEach(e=>{ ctx.beginPath(); ctx.arc(e.x,e.y,e.radius,0,Math.PI*2); ctx.fillStyle='rgba(255,69,0,0.5)'; ctx.fill(); }); }
function drawStars(){ ctx.fillStyle="white"; stars.forEach(s=>{ ctx.fillRect(s.x,s.y,s.size,s.size); s.y+=s.speed; if(s.y>canvas.height){ s.y=0; s.x=Math.random()*canvas.width; } }); }
function checkCollision(a,b){ return a.x<b.x+b.width && a.x+a.width>b.x && a.y<b.y+b.height && a.y+a.height>b.y; }

function gameLoop(){
    if(!gameRunning) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawStars(); updateShip(); drawShip(); updateBullets(); drawBullets();
    updateAsteroids(); drawAsteroids(); updateItems(); drawItems(); updateExplosions(); drawExplosions();
    frameCount++; animationFrameId=requestAnimationFrame(gameLoop);
}

startButton.addEventListener('click', startGame);
restartButton.addEventListener('click', startGame);
</script>
</body>
</html>
